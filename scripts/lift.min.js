Rickshaw.namespace("Rickshaw.Graph.Axis.LabeledY"),Rickshaw.Graph.Axis.LabeledY=Rickshaw.Class.create(Rickshaw.Graph.Axis.Y,{initialize:function(a){this.label=a.label||"",this.graph=a.graph,this.orientation=a.orientation||"right",this.pixelsPerTick=a.pixelsPerTick||75,a.ticks&&(this.staticTicks=a.ticks),a.tickValues&&(this.tickValues=a.tickValues),this.tickSize=a.tickSize||4,this.ticksTreatment=a.ticksTreatment||"plain",this.tickFormat=a.tickFormat||function(a){return a},this.berthRate=.1,a.element?(this.element=a.element,this.vis=d3.select(a.element).append("svg:svg").attr("class","rickshaw_graph y_axis"),this.element=this.vis[0][0],this.element.style.position="relative",this.setSize({width:a.width,height:a.height})):this.vis=this.graph.vis;var b=this;this.graph.onUpdate(function(){b.render()})},_drawAxis:function(a){var b=d3.svg.axis().scale(a).orient(this.orientation);if(b.tickFormat(this.tickFormat),this.tickValues&&b.tickValues(this.tickValues),"left"==this.orientation)var c=this.height*this.berthRate,d="translate("+this.width+", "+c+")";return this.element&&this.vis.selectAll("*").remove(),this.vis.append("svg:g").attr("class",["y_ticks",this.ticksTreatment].join(" ")).attr("transform",d).call(b.ticks(this.ticks).tickSubdivide(0).tickSize(this.tickSize)),label=this.vis.append("svg:text").attr("class","y-axis-label").attr("x",this.height/4*-1).attr("y",this.width/3).attr("text-anchor","middle").attr("transform","rotate(-90 50 50)").text(this.label),b}}),Rickshaw.namespace("Rickshaw.Graph.ClickDetail"),Rickshaw.Graph.ClickDetail=Rickshaw.Class.create(Rickshaw.Graph.HoverDetail,{formatter:function(a,b){var c=this,d=this.graph.rawData.options,e=this.graph.rawData.columns,f=e[d.columnX-1],g=(e[d.columnY-1],e[d.columnName-1]),h=this.graph.rawData.groups,i=new Date(1e3*b),j=["January","February","March","April","May","June","July","April","September","June","July","August","September","October","November","December"];return humanDate=j[i.getUTCMonth()]+" "+i.getDate()+", "+i.getFullYear(),head=function(){for(var a="<th>"+humanDate+"</th>",b="",d=0;d<c.graph.series.length;d++)b=b+'<th style="background-color: '+c.graph.series[d].color+';">'+c.graph.series[d].shortName+"</th>";return"<thead><tr>"+a+b+"</tr></thead>"},row=function(a){for(var b='<td class="label">'+a.property+"</td>",c=0;c<a.data.length;c++)b="undefined"!=typeof a.data[c].active&&1==a.data[c].active?b+'<td class="active">'+a.data[c].value+"</td>":b+"<td>"+a.data[c].value+"</td>";return"<tr>"+b+"</tr>"},rows=function(){for(var c="",d=0;d<h[a.name].length;d++)if(h[a.name][d][f]==b)for(var e in h[a.name][d])if(h[a.name][d].hasOwnProperty(e)&&e!=f&&e!=g){var i={property:e,data:[]};for(var j in h)if(h.hasOwnProperty(j)){var k={value:h[j][d][e]};a.name==h[j][d][g]&&(k.active=!0),i.data.push(k)}c+=row(i)}return"<tbody>"+c+"</tbody>"},'<div class="lift-graph-detail"><table class="lift-graph-detail-data">'+head()+rows()+"</table></div>"},render:function(a){var b=this.graph,c=a.points,d=c.filter(function(a){return a.active}).shift();if(null!==d.value.y){var e=d.formattedXValue,f=d.formattedYValue;this.element.innerHTML="",this.element.style.left=b.x(d.value.x)+"px";var g=document.createElement("div");g.className="item",g.style.maxWidth=$(b.element).width()+"px";var h=d.series,i=h.scale?h.scale.invert(d.value.y):d.value.y;g.innerHTML=this.formatter(h,d.value.x,i,e,f,d),this.element.appendChild(g);var j=document.createElement("div"),k=this.graph.y(d.value.y0+d.value.y);j.className="dot",j.style.top=k+"px",j.style.borderColor=h.color,this.element.appendChild(j),d.active&&(g.classList.add("active"),j.classList.add("active"));var l=$(g),m=parseInt(l.innerWidth()),n=parseInt(l.innerHeight()),o=parseInt(l.css("margin-top"))+parseInt(l.css("margin-bottom"));g.style.top=Math.round(k-n-o)+"px",g.style.left=-1*Math.round(m/2)+"px";var p=[g];p.forEach(function(a){a.classList.add("bottom"),a.classList.add("center")}),this.show();var q=this._calcLayout(g);q.left>q.right&&(g.style.left="auto",g.classList.remove("center"),g.classList.remove("right"),g.classList.add("left")),q.right>q.left&&(g.style.left="auto",g.classList.remove("center"),g.classList.remove("left"),g.classList.add("right")),0===q.top&&(g.style.top=k+"px",g.classList.remove("bottom"),g.classList.add("top")),"function"==typeof this.onRender&&this.onRender(a)}},_calcLayout:function(a){var b={top:0,right:0,bottom:0,left:0},c=this.element.parentNode.getBoundingClientRect(),d=a.getBoundingClientRect();return d.top>c.top&&(b.top+=d.top-c.top),d.bottom<c.bottom&&(b.bottom+=c.bottom-d.bottom),d.right>c.right&&(b.right+=d.right-c.right),d.left<c.left&&(b.left+=c.left-d.left),b},_addListeners:function(){this.graph.element.addEventListener("click",function(a){this.visible=!0,this.update(a)}.bind(this),!1),this.graph.onUpdate(function(){this.update()}.bind(this))}}),Rickshaw.namespace("Rickshaw.Graph.TableLegend"),Rickshaw.Graph.TableLegend=Rickshaw.Class.create(Rickshaw.Graph.Legend,{initialize:function(a){this.element=a.element,this.graph=a.graph,this.render(),this.graph.onUpdate(function(){})},render:function(){{var a=this;$(this.element).find("thead > tr > th:first-child")}$(this.element).find("thead > tr").prepend("<th>Legend</th>"),this.lines=[];var b=this.graph.series.map(function(a){return a});b.forEach(function(b){a.addLine(b)})},addLine:function(a){var b=this;$(this.element).find("tbody > tr").each(function(c,d){if($(d).find("td:first-child").text()==a.name){var e=document.createElement("td");$(d).prepend(e),e.className="legend line",a.disabled&&(e.className+=" disabled"),a.className&&d3.select(e).classed(a.className,!0);var f=document.createElement("div");f.className="swatch",f.style.backgroundColor=a.color,e.appendChild(f);var g=document.createElement("span");g.className="label",g.innerHTML=a.shortName||a.name,e.appendChild(g),e.series=a,a.noLegend&&(e.style.display="none");var h={element:e,series:a};return b.shelving&&(b.shelving.addAnchor(h),b.shelving.updateBehaviour()),b.highlighter&&b.highlighter.addHighlightEvents(h),b.lines.push(h),e}})}}),+function(a){"use strict";var b=function(a,b){this.type=this.options=this.enabled=this.$element=null,this.init("liftGraph",a,b)};b.DEFAULTS={columnName:1,columnX:2,columnY:3,scheme:null,renderer:null,width:null,height:null,min:null,max:null,padding:null,interpolation:"linear",stack:null},b.prototype.init=function(b,c,d){this.type=b,this.$element=a(c),this.options=this.getOptions(d),this.enabled=!0,this.render()},b.prototype.enable=function(){this.enabled=!0},b.prototype.disable=function(){this.enabled=!1},b.prototype.dataAttr=function(a){return this.$element.attr("data-"+this.type+"-"+a)},b.prototype.getDefaults=function(){return b.DEFAULTS},b.prototype.destroy=function(){this.hide().$element.off("."+this.type).removeData("lift."+this.type)},b.prototype.getOptions=function(b){b=a.extend({},this.getDefaults(),b);for(var c in b)b[c]=this.dataAttr(c)||b[c];return b},b.prototype.getData=function(){var b=[],c=[],d={};this.$element.find("thead > tr > th").each(function(c){b[c]=a(this).text()}),this.$element.find("tbody > tr").each(function(d){c[d]={},a(this).children("td").each(function(e){c[d][b[e]]=a(this).text()})});for(var e=b[this.options.columnName-1],f=0;f<c.length;f++)"undefined"==typeof d[c[f][e]]&&(d[c[f][e]]=[]),d[c[f][e]].push(c[f]);this.columns=b,this.groups=d},b.prototype.buildSeries=function(b,c){var d=this.groups,e=this.columns[b-1],f=this.columns[c-1],g=[],h=(a(".lift-graph-results > tbody > tr > td:first-child"),0);for(var i in d)if(d.hasOwnProperty(i)){for(var j=[],k=0;k<d[i].length;k++)j.push({x:parseFloat(d[i][k][e]),y:parseFloat(d[i][k][f])});g[h]={name:i,color:this.palette.color(),data:j,shortName:"control"==i.substring(0,7)?"Control":"V"+(h+1)},h++}this.series=g},b.prototype.getPalette=function(){var a=new Rickshaw.Fixtures.Color,b=this.options.scheme||"colorwheel",c={scheme:b},d=0;for(var e in this.groups)this.groups.hasOwnProperty(e)&&d++;a.schemes[b].length<d&&(c.interpolatedStopCount=d),this.palette=new Rickshaw.Color.Palette(c)},b.prototype.getGraph=function(){var a={element:this.$graph[0],series:this.series};if(null!=this.options.renderer&&(a.renderer=this.options.renderer),a.width=null!=this.options.width?this.options.width:this.$graph.width(),a.height=null!=this.options.height?this.options.height:this.$graph.height(),null!=this.options.max&&(a.max=this.options.max),null!=this.options.min&&(a.min=this.options.min),null!=this.options.padding){for(var b=this.options.padding.split(" "),c=b.length,d={},e=["top","right","bottom","left"],f=0;c>f;f++)d[e[f]]=parseFloat(b[f]);a.padding=d}null!=this.options.interpolation&&(a.interpolation=this.options.interpolation),null!=this.options.stack&&(a.stack=this.options.stack),this.graph=new Rickshaw.Graph(a),this.graph.rawData=this},b.prototype.setAxisX=function(){this.axisX=new Rickshaw.Graph.Axis.Time({graph:this.graph})},b.prototype.setAxisY=function(){this.axisY=new Rickshaw.Graph.Axis.LabeledY({element:this.$axisY[0],orientation:"left",label:this.columns[this.options.columnY-1],graph:this.graph})},b.prototype.setLegend=function(){this.legend=new Rickshaw.Graph.TableLegend({element:this.$legend[0],graph:this.graph})},b.prototype.build=function(){this.$graph=a('<div class="lift-graph-graph" role="presentation"></div>'),this.$axisY=a('<div class="lift-graph-axis-y" role="presentation"></div>'),this.$legend=a("table.lift-graph-result-data"),this.$element.addClass("lift-graph-table").wrap('<div class="lift-graph-container"></div>').before(this.$axisY).before(this.$graph).before(this.$axisX)},b.prototype.hideTable=function(){this.$element.hide()},b.prototype.showTable=function(){this.$element.show()},b.prototype.setHoverDetail=function(){this.hoverDetail=new Rickshaw.Graph.ClickDetail({graph:this.graph})},b.prototype.setSeriesHighlight=function(){this.seriesHighlight=new Rickshaw.Graph.Behavior.Series.Highlight({graph:this.graph,legend:this.legend})},b.prototype.setSeriesToggle=function(){this.seriesToggle=new Rickshaw.Graph.Behavior.Series.Toggle({graph:this.graph,legend:this.legend})},b.prototype.render=function(){this.getData(),this.getPalette(),this.buildSeries(this.options.columnX,this.options.columnY),this.build(),this.getGraph(),this.setAxisX(),this.setAxisY(),this.setLegend(),this.setHoverDetail(),this.setSeriesHighlight(),this.setSeriesToggle(),this.graph.render(),this.hideTable()};var c=a.fn.railroad;a.fn.liftGraph=function(){return this.each(function(){var c=a(this),d=c.data("lift.graph"),e="object"==typeof e&&option;(d||"destroy"!=e)&&(d||c.data("lift.graph",d=new b(this,e)),"string"==typeof option&&d[option]())})},a.fn.liftGraph.Constrictor=b,a.fn.liftGraph.noConflict=function(){return a.fn.liftGraph=c,this}}(jQuery);
//# sourceMappingURL=lift.min.js.map