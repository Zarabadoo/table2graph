Rickshaw.namespace("Rickshaw.Graph.Axis.TimeElement"),Rickshaw.Graph.Axis.TimeElement=function(a){var b=this,c=.1,d=a.timeFixture||new Rickshaw.Fixtures.Time;this.initialize=function(a){this.graph=a.graph,this.elements=[],this.orientation=a.orientation||"top",this.pixelsPerTick=a.pixelsPerTick||75,a.ticks&&(this.staticTicks=a.ticks),a.tickValues&&(this.tickValues=a.tickValues),this.tickSize=a.tickSize||4,this.ticksTreatment=a.ticksTreatment||"plain",a.element?(this.element=a.element,this._discoverSize(a.element,a),this.vis=d3.select(a.element).append("svg:svg").attr("height",this.height).attr("width",this.width).attr("class","rickshaw_graph x_axis_d3"),this.element=this.vis[0][0],this.element.style.position="relative",this.setSize({width:a.width,height:a.height})):this.vis=this.graph.vis,this.graph.onUpdate(function(){b.render()})},this.setSize=function(a){if(a=a||{},this.element){this._discoverSize(this.element.parentNode,a),this.vis.attr("height",this.height).attr("width",this.width*(1+c));var b=Math.floor(this.width*c/2);this.element.style.left=-1*b+"px"}},this.appropriateTimeUnit=function(){var a,b=d.units,c=this.graph.x.domain(),e=c[1]-c[0];return b.forEach(function(b){Math.floor(e/b.seconds)>=2&&(a=a||b)}),a||d.units[d.units.length-1]},this.render=function(){this.elements.forEach(function(a){a.parentNode.removeChild(a)});var b=this.fixedTimeUnit||this.appropriateTimeUnit();void 0!==this._renderWidth&&this.graph.width!==this._renderWidth&&this.setSize({auto:!0});var d=d3.svg.axis().scale(this.graph.x).orient(this.orientation);d.tickFormat(a.tickFormat||function(a){return b.formatter(new Date(1e3*a))}),this.tickValues&&d.tickValues(this.tickValues),this.ticks=this.staticTicks||Math.floor(this.graph.width/this.pixelsPerTick);var e,f=Math.floor(this.width*c/2)||0;if("top"==this.orientation){var g=this.height||this.graph.height;e="translate("+f+","+g+")"}else e="translate("+f+", 0)";this.element&&this.vis.selectAll("*").remove(),this.vis.append("svg:g").attr("class",["x_ticks_d3",this.ticksTreatment].join(" ")).attr("transform",e).call(d.ticks(this.ticks).tickSubdivide(0).tickSize(this.tickSize));var h=("bottom"==this.orientation?1:-1)*this.graph.height;this.graph.vis.append("svg:g").attr("class","x_grid_d3").call(d.ticks(this.ticks).tickSubdivide(0).tickSize(h)).selectAll("text").each(function(){this.parentNode.setAttribute("data-x-value",this.textContent)}),this._renderHeight=this.graph.height},this._discoverSize=function(a,b){if("undefined"!=typeof window){var d=window.getComputedStyle(a,null),e=parseInt(d.getPropertyValue("height"),10);if(!b.auto)var f=parseInt(d.getPropertyValue("width"),10)}this.width=(b.width||f||this.graph.width)*(1+c),this.height=b.height||e||40},this.initialize(a)},Rickshaw.namespace("Rickshaw.Graph.Axis.LabeledY"),Rickshaw.Graph.Axis.LabeledY=Rickshaw.Class.create(Rickshaw.Graph.Axis.Y,{initialize:function(a){this.label=a.label||"",this.graph=a.graph,this.orientation=a.orientation||"right",this.pixelsPerTick=a.pixelsPerTick||75,a.ticks&&(this.staticTicks=a.ticks),a.tickValues&&(this.tickValues=a.tickValues),this.tickSize=a.tickSize||4,this.ticksTreatment=a.ticksTreatment||"plain",this.tickFormat=a.tickFormat||function(a){return a},this.berthRate=.1,a.element?(this.element=a.element,this.vis=d3.select(a.element).append("svg:svg").attr("class","rickshaw_graph y_axis"),this.element=this.vis[0][0],this.element.style.position="relative",this.setSize({width:a.width,height:a.height})):this.vis=this.graph.vis;var b=this;this.graph.onUpdate(function(){b.render()})},_drawAxis:function(a){var b=d3.svg.axis().scale(a).orient(this.orientation);if(b.tickFormat(this.tickFormat),this.tickValues&&b.tickValues(this.tickValues),"left"==this.orientation)var c=this.height*this.berthRate,d="translate("+this.width+", "+c+")";return this.element&&this.vis.selectAll("*").remove(),this.vis.append("svg:g").attr("class",["y_ticks",this.ticksTreatment].join(" ")).attr("transform",d).call(b.ticks(this.ticks).tickSubdivide(0).tickSize(this.tickSize)),label=this.vis.append("svg:text").attr("class","y-axis-label").attr("x",this.height/4*-1).attr("y",this.width/3).attr("text-anchor","middle").attr("transform","rotate(-90 50 50)").text(this.label),b}}),Rickshaw.namespace("Rickshaw.Graph.ClickDetail"),Rickshaw.Graph.ClickDetail=Rickshaw.Class.create(Rickshaw.Graph.HoverDetail,{formatter:function(a,b){var c=this,d=this.graph.rawData.options,e=this.graph.rawData.columns,f=e[d.columnX-1],g=(e[d.columnY-1],e[d.columnName-1]),h=this.graph.rawData.groups,i=new Date(1e3*b),j=["January","February","March","April","May","June","July","April","September","June","July","August","September","October","November","December"];return humanDate=j[i.getUTCMonth()]+" "+i.getDate()+", "+i.getFullYear(),head=function(){for(var a="<th>"+humanDate+"</th>",b="",d=0;d<c.graph.series.length;d++)b=b+'<th style="background-color: '+c.graph.series[d].color+';">'+c.graph.series[d].shortName+"</th>";return"<thead><tr>"+a+b+"</tr></thead>"},row=function(a){for(var b='<td class="label">'+a.property+"</td>",c=0;c<a.data.length;c++)b="undefined"!=typeof a.data[c].active&&1==a.data[c].active?b+'<td class="active">'+a.data[c].value+"</td>":b+"<td>"+a.data[c].value+"</td>";return"<tr>"+b+"</tr>"},rows=function(){for(var c="",d=0;d<h[a.name].length;d++)if(h[a.name][d][f]==b)for(var e in h[a.name][d])if(h[a.name][d].hasOwnProperty(e)&&e!=f&&e!=g){var i={property:e,data:[]};for(var j in h)if(h.hasOwnProperty(j)){var k={value:h[j][d][e]};a.name==h[j][d][g]&&(k.active=!0),i.data.push(k)}c+=row(i)}return"<tbody>"+c+"</tbody>"},'<div class="lift-graph-detail"><table class="lift-graph-detail-data">'+head()+rows()+"</table></div>"},render:function(a){var b=jQuery,c=this.graph,d=a.points,e=d.filter(function(a){return a.active}).shift();if(null!==e.value.y){var f=e.formattedXValue,g=e.formattedYValue;this.element.innerHTML="",this.element.style.left=c.x(e.value.x)+"px";var h=document.createElement("div");h.className="item",h.style.maxWidth=b(c.element).width()+"px";var i=e.series,j=i.scale?i.scale.invert(e.value.y):e.value.y;h.innerHTML=this.formatter(i,e.value.x,j,f,g,e),this.element.appendChild(h);var k=document.createElement("div"),l=this.graph.y(e.value.y0+e.value.y);k.className="dot",k.style.top=l+"px",k.style.borderColor=i.color,this.element.appendChild(k),e.active&&(h.classList.add("active"),k.classList.add("active"));var m=b(h),n=parseInt(m.innerWidth()),o=parseInt(m.innerHeight()),p=parseInt(m.css("margin-top"))+parseInt(m.css("margin-bottom"));h.style.top=Math.round(l-o-p)+"px",h.style.left=-1*Math.round(n/2)+"px";var q=[h];q.forEach(function(a){a.classList.add("bottom"),a.classList.add("center")}),this.show();var r=this._calcLayout(h);r.left>r.right&&(h.style.left="auto",h.classList.remove("center"),h.classList.remove("right"),h.classList.add("left")),r.right>r.left&&(h.style.left="auto",h.classList.remove("center"),h.classList.remove("left"),h.classList.add("right")),0===r.top&&(h.style.top=l+"px",h.classList.remove("bottom"),h.classList.add("top")),"function"==typeof this.onRender&&this.onRender(a)}},_calcLayout:function(a){var b={top:0,right:0,bottom:0,left:0},c=this.element.parentNode.getBoundingClientRect(),d=a.getBoundingClientRect();return d.top>c.top&&(b.top+=d.top-c.top),d.bottom<c.bottom&&(b.bottom+=c.bottom-d.bottom),d.right>c.right&&(b.right+=d.right-c.right),d.left<c.left&&(b.left+=c.left-d.left),b},_addListeners:function(){this.graph.element.addEventListener("click",function(a){this.visible=!0,this.update(a)}.bind(this),!1),this.graph.onUpdate(function(){this.update()}.bind(this))}}),Rickshaw.namespace("Rickshaw.Graph.TableLegend"),Rickshaw.Graph.TableLegend=Rickshaw.Class.create(Rickshaw.Graph.Legend,{initialize:function(a){this.element=a.element,this.graph=a.graph,this.render(),this.graph.onUpdate(function(){})},render:function(){{var a=jQuery,b=this;a(this.element).find("thead > tr > th:first-child")}a(this.element).find("thead > tr").prepend("<th>Legend</th>"),this.lines=[];var c=this.graph.series.map(function(a){return a});c.forEach(function(a){b.addLine(a)})},addLine:function(a){var b=jQuery,c=this;b(this.element).find("tbody > tr").each(function(d,e){if(b(e).find("td:first-child").text()==a.name){var f=document.createElement("td");b(e).prepend(f),f.className="legend line",a.disabled&&(f.className+=" disabled"),a.className&&d3.select(f).classed(a.className,!0);var g=document.createElement("div");g.className="swatch",g.style.backgroundColor=a.color,f.appendChild(g);var h=document.createElement("span");h.className="label",h.innerHTML=a.shortName||a.name,f.appendChild(h),f.series=a,a.noLegend&&(f.style.display="none");var i={element:f,series:a};return c.shelving&&(c.shelving.addAnchor(i),c.shelving.updateBehaviour()),c.highlighter&&c.highlighter.addHighlightEvents(i),c.lines.push(i),f}})}}),+function(a){"use strict";var b=function(a,b){this.type=this.options=this.enabled=this.$element=null,this.init("liftGraph",a,b)};b.DEFAULTS={columnName:1,columnX:2,columnY:3,scheme:null,renderer:null,width:null,height:null,min:null,max:null,padding:null,interpolation:"linear",stack:null},b.prototype.init=function(b,c,d){this.type=b,this.$element=a(c),this.options=this.getOptions(d),this.enabled=!0,this.render()},b.prototype.enable=function(){this.enabled=!0},b.prototype.disable=function(){this.enabled=!1},b.prototype.dataAttr=function(a){return this.$element.attr("data-"+this.type+"-"+a)},b.prototype.getDefaults=function(){return b.DEFAULTS},b.prototype.destroy=function(){this.hide().$element.off("."+this.type).removeData("lift."+this.type)},b.prototype.getOptions=function(b){b=a.extend({},this.getDefaults(),b);for(var c in b)b[c]=this.dataAttr(c)||b[c];return b},b.prototype.getData=function(){var b=[],c=[],d={};this.$element.find("thead > tr > th").each(function(c){b[c]=a(this).text()}),this.$element.find("tbody > tr").each(function(d){c[d]={},a(this).children("td").each(function(e){c[d][b[e]]=a(this).text()})});for(var e=b[this.options.columnName-1],f=0;f<c.length;f++)"undefined"==typeof d[c[f][e]]&&(d[c[f][e]]=[]),d[c[f][e]].push(c[f]);this.columns=b,this.groups=d},b.prototype.buildSeries=function(b,c){var d=this.groups,e=this.columns[b-1],f=this.columns[c-1],g=[],h=(a(".lift-graph-results > tbody > tr > td:first-child"),0);for(var i in d)if(d.hasOwnProperty(i)){for(var j=[],k=0;k<d[i].length;k++)j.push({x:parseFloat(d[i][k][e]),y:parseFloat(d[i][k][f])});g[h]={name:i,color:this.palette.color(),data:j,shortName:"control"==i.substring(0,7)?"Control":"V"+(h+1)},h++}this.series=g},b.prototype.getPalette=function(){var a=new Rickshaw.Fixtures.Color,b=this.options.scheme||"colorwheel",c={scheme:b},d=0;for(var e in this.groups)this.groups.hasOwnProperty(e)&&d++;a.schemes[b].length<d&&(c.interpolatedStopCount=d),this.palette=new Rickshaw.Color.Palette(c)},b.prototype.getGraph=function(){var a={element:this.$graph[0],series:this.series};if(null!=this.options.renderer&&(a.renderer=this.options.renderer),a.width=null!=this.options.width?this.options.width:this.$graph.width(),a.height=null!=this.options.height?this.options.height:this.$graph.height(),null!=this.options.max&&(a.max=this.options.max),null!=this.options.min&&(a.min=this.options.min),null!=this.options.padding){for(var b=this.options.padding.split(" "),c=b.length,d={},e=["top","right","bottom","left"],f=0;c>f;f++)d[e[f]]=parseFloat(b[f]);a.padding=d}null!=this.options.interpolation&&(a.interpolation=this.options.interpolation),null!=this.options.stack&&(a.stack=this.options.stack),this.graph=new Rickshaw.Graph(a),this.graph.rawData=this},b.prototype.setAxisX=function(){this.axisX=new Rickshaw.Graph.Axis.TimeElement({element:this.$axisX[0],orientation:"bottom",graph:this.graph})},b.prototype.setAxisY=function(){this.axisY=new Rickshaw.Graph.Axis.LabeledY({element:this.$axisY[0],orientation:"left",label:this.columns[this.options.columnY-1],graph:this.graph})},b.prototype.setLegend=function(){this.legend=new Rickshaw.Graph.TableLegend({element:this.$legend[0],graph:this.graph})},b.prototype.setRangeSlider=function(){this.rangeSlider=new Rickshaw.Graph.RangeSlider({element:this.$rangeSlider[0],graph:this.graph})},b.prototype.setHoverDetail=function(){this.hoverDetail=new Rickshaw.Graph.ClickDetail({graph:this.graph})},b.prototype.setSeriesHighlight=function(){this.seriesHighlight=new Rickshaw.Graph.Behavior.Series.Highlight({graph:this.graph,legend:this.legend})},b.prototype.setSeriesToggle=function(){this.$legend.addClass("toggle-enabled"),this.seriesToggle=new Rickshaw.Graph.Behavior.Series.Toggle({graph:this.graph,legend:this.legend})},b.prototype.build=function(){this.$graph=a('<div class="lift-graph-graph" role="presentation"></div>'),this.$axisY=a('<div class="lift-graph-axis-y" role="presentation"></div>'),this.$axisX=a('<div class="lift-graph-axis-x" role="presentation"></div>'),this.$legend=a("table.lift-graph-result-data"),this.$rangeSlider=a('<div class="lift-graph-range-slider" role="presentation"></div>'),this.$element.addClass("lift-graph-table").wrap('<div class="lift-graph-container"></div>').before(this.$axisY).before(this.$graph).before(this.$axisX).before(this.$rangeSlider)},b.prototype.hideTable=function(){this.$element.hide()},b.prototype.showTable=function(){this.$element.show()},b.prototype.render=function(){this.getData(),this.getPalette(),this.buildSeries(this.options.columnX,this.options.columnY),this.build(),this.getGraph(),this.setAxisX(),this.setAxisY(),this.setLegend(),this.setRangeSlider(),this.setHoverDetail(),this.setSeriesHighlight(),this.setSeriesToggle(),this.graph.render(),this.hideTable()};var c=a.fn.railroad;a.fn.liftGraph=function(){return this.each(function(){var c=a(this),d=c.data("lift.graph"),e="object"==typeof e&&option;(d||"destroy"!=e)&&(d||c.data("lift.graph",d=new b(this,e)),"string"==typeof option&&d[option]())})},a.fn.liftGraph.Constrictor=b,a.fn.liftGraph.noConflict=function(){return a.fn.liftGraph=c,this}}(jQuery);
//# sourceMappingURL=lift.min.js.map